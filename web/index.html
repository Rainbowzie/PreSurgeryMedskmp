<script>
  const form = document.getElementById('medForm');
  const results = document.getElementById('results');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const animal = document.getElementById('animalType').value;
    const weight = document.getElementById('weight').value;

    if (!weight) {
      results.textContent = "❌ Please enter a weight.";
      return;
    }

    const base = window.location.origin; // e.g. https://presurgerymeds-kmp.onrender.com
    const url = `${base}/medications?animal=${encodeURIComponent(animal)}&weight=${encodeURIComponent(weight)}`;

    try {
      const res = await fetch(url, { method: 'GET' });

      // if server ever sends HTML (like an error page), guard against it
      const contentType = res.headers.get('content-type') || '';
      if (!res.ok) {
        const text = await res.text();
        results.textContent = `❌ Error ${res.status}: ${text}`;
        return;
      }
      if (!contentType.includes('application/json')) {
        const text = await res.text();
        results.textContent = `⚠️ Unexpected response (not JSON):\n\n${text}`;
        return;
      }

      const data = await res.json();

      // pretty render
      results.innerHTML = ""; // clear
      if (data.error) {
        results.textContent = `❌ ${data.error}`;
        return;
      }

      const title = document.createElement('h3');
      title.textContent = `Results for ${data.animal} (${data.weight} lbs)`;
      results.appendChild(title);

      if (Array.isArray(data.medications) && data.medications.length) {
        const ul = document.createElement('ul');
        data.medications.forEach(med => {
          const li = document.createElement('li');
          li.textContent = med;
          ul.appendChild(li);
        });
        results.appendChild(ul);
      } else {
        const p = document.createElement('p');
        p.textContent = "No medication recommendations returned.";
        results.appendChild(p);
      }
    } catch (err) {
      results.textContent = "❌ Request failed: " + err.message;
    }
  });
</script>

